<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../../../../../">
  <title data-ice="title">WTF-Adventure/src/server/js/game/entity/character/player/player.js | WTF Adventure</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="documentation for your wtf needs"><meta property="og:type" content="website"><meta property="og:url" content="http://design1online.com"><meta property="og:site_name" content="WTF Adventure"><meta property="og:title" content="WTF Adventure"><meta property="og:image" content="http://design1online.com/logo.png"><meta property="og:description" content="documentation for your wtf needs"><meta property="og:author" content="https://design1online.com"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="WTF Adventure"><meta property="twitter:description" content="documentation for your wtf needs"><meta property="twitter:image" content="http://design1online.com/logo.png"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/design1online/WTF-Adventure"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js">src/client/js</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/app.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/game.js~Game.html">Game</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/main.js~WTF.html">WTF</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-controllers">src/client/js/controllers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/audio.js~Audio.html">Audio</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/bubble.js~Bubble.html">Bubble</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/chat.js~Chat.html">Chat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/entities.js~Entities.html">Entities</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/info.js~Info.html">Info</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/input.js~Input.html">Input</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/interface.js~Interface.html">Interface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/overlay.js~Overlay.html">Overlay</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/pickcharacter.js~PickCharacter.html">PickCharacter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/pointer.js~Cursor.html">Cursor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/sprites.js~Sprites.html">Sprites</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/controllers/zoning.js~Zone.html">Zone</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-entity">src/client/js/entity</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/animation.js~Animation.html">Animation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/entity.js~Entity.html">Entity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/entityhandler.js~EntityHandler.html">EntityHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/sprite.js~Sprite.html">Sprite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-entity-character">src/client/js/entity/character</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/character.js~Character.html">Character</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-entity-character-mob">src/client/js/entity/character/mob</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/mob/mob.js~Mob.html">Mob</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-entity-character-npc">src/client/js/entity/character/npc</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/npc/npc.js~Npc.html">Npc</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-entity-character-player">src/client/js/entity/character/player</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/player.js~Player.html">Player</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/playerhandler.js~PlayerHandler.html">PlayerHandler</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-entity-character-player-equipment">src/client/js/entity/character/player/equipment</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/equipment/armour.js~Armour.html">Armour</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/equipment/boots.js~Boots.html">Boots</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/equipment/equipment.js~Equipment.html">Equipment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/equipment/pendant.js~Pendant.html">Pendant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/equipment/ring.js~Ring.html">Ring</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/character/player/equipment/weapon.js~Weapon.html">Weapon</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-entity-objects">src/client/js/entity/objects</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/objects/chest.js~Chest.html">Chest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/objects/item.js~Item.html">Item</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/entity/objects/projectile.js~Projectile.html">Projectile</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-interface">src/client/js/interface</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/abilities.js~Abilities.html">Abilities</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/actions.js~Actions.html">Actions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/bank.js~Bank.html">Bank</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/enchant.js~Enchant.html">Enchant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/inventory.js~Inventory.html">Inventory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/warp.js~Warp.html">Warp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-interface-container">src/client/js/interface/container</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/container/container.js~Container.html">Container</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/container/slot.js~Slot.html">Slot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-interface-profile">src/client/js/interface/profile</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/profile/page.js~Page.html">Page</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/profile/profile.js~Profile.html">Profile</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-interface-profile-pages">src/client/js/interface/profile/pages</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/profile/pages/ability.js~Ability.html">Ability</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/profile/pages/quest.js~Quest.html">Quest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/profile/pages/settings.js~Settings.html">Settings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/interface/profile/pages/state.js~State.html">State</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-lib">src/client/js/lib</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/lib/log.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-logger">logger</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-map">src/client/js/map</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/map/map.js~Map.html">Map</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-network">src/client/js/network</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/network/messages.js~Messages.html">Messages</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/network/socket.js~Socket.html">Socket</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Packets">Packets</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-renderer">src/client/js/renderer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/camera.js~Camera.html">Camera</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/grids.js~Grids.html">Grids</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/renderer.js~Renderer.html">Renderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/tile.js~Tile.html">Tile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/updater.js~Updater.html">Updater</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-renderer-bubbles">src/client/js/renderer/bubbles</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/bubbles/blob.js~Blob.html">Blob</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-renderer-infos">src/client/js/renderer/infos</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/infos/splat.js~Splat.html">Splat</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-renderer-pointers">src/client/js/renderer/pointers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/renderer/pointers/pointer.js~Pointer.html">Pointer</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-client-js-utils">src/client/js/utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/utils/pathfinder.js~Pathfinder.html">Pathfinder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/utils/queue.js~Queue.html">Queue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/utils/storage.js~Storage.html">Storage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/utils/timer.js~Timer.html">Timer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/client/js/utils/transition.js~Transition.html">Transition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isInt">isInt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isIntersecting">isIntersecting</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TRANSITIONEND">TRANSITIONEND</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-requestAnimFrame">requestAnimFrame</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-data-combat">src/server/data/combat</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/data/combat/greatsquid.js~GreatSquid.html">GreatSquid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/data/combat/ogrelord.js~OgreLord.html">OgreLord</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/data/combat/piratecaptain.js~PirateCaptain.html">PirateCaptain</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/data/combat/queenant.js~QueenAnt.html">QueenAnt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/data/combat/skeletonking.js~SkeletonKing.html">SkeletonKing</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/data/combat/tenebris.js~Tenebris.html">Tenebris</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-data-items">src/server/data/items</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/data/items/healthFlask.js~Flask.html">Flask</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-controllers">src/server/js/controllers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/controllers/commands.js~Commands.html">Commands</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/controllers/incoming.js~Incoming.html">Incoming</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/controllers/minigames.js~Minigames.html">Minigames</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/controllers/quests.js~Quests.html">Quests</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/controllers/shops.js~Shops.html">Shops</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-database">src/server/js/database</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/database/creator.js~Creator.html">Creator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/database/loader.js~Loader.html">Loader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/database/mysql.js~MySQL.html">MySQL</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game">src/server/js/game</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/world.js~World.html">World</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity">src/server/js/game/entity</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/entity.js~Entity.html">Entity</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character">src/server/js/game/entity/character</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/character.js~Character.html">Character</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-combat">src/server/js/game/entity/character/combat</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/combat/combat.js~Combat.html">Combat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/combat/combatqueue.js~CombatQueue.html">CombatQueue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/combat/hit.js~Hit.html">Hit</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-mob">src/server/js/game/entity/character/mob</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/mob/mob.js~Mob.html">Mob</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player">src/server/js/game/entity/character/player</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/achievement.js~Achievement.html">Achievement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/checkpoint.js~Checkpoint.html">Checkpoint</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/guild.js~Guild.html">Guild</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/handler.js~Handler.html">Handler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/player.js~Player.html">Player</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/trade.js~Trade.html">Trade</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/warp.js~Warp.html">Warp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-ability">src/server/js/game/entity/character/player/ability</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/ability/abilities.js~Abilities.html">Abilities</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-ability-misc">src/server/js/game/entity/character/player/ability/misc</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/ability/misc/ability.js~Ability.html">Ability</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/ability/misc/firestrike.js~FireStrike.html">FireStrike</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/ability/misc/iceattack.js~IceAttack.html">IceAttack</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/ability/misc/run.js~Run.html">Run</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-containers">src/server/js/game/entity/character/player/containers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/containers/container.js~Container.html">Container</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/containers/slot.js~Slot.html">Slot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-containers-bank">src/server/js/game/entity/character/player/containers/bank</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/containers/bank/bank.js~Slot.html">Slot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-containers-inventory">src/server/js/game/entity/character/player/containers/inventory</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/containers/inventory/inventory.js~Inventory.html">Inventory</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-enchant">src/server/js/game/entity/character/player/enchant</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/enchant/enchant.js~Enchant.html">Enchant</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-equipment">src/server/js/game/entity/character/player/equipment</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/equipment/armour.js~Armour.html">Armour</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/equipment/boots.js~Boots.html">Boots</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/equipment/equipment.js~Equipment.html">Equipment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/equipment/pendant.js~Pendant.html">Pendant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/equipment/ring.js~Ring.html">Ring</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/equipment/weapon.js~Weapon.html">Weapon</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-points">src/server/js/game/entity/character/player/points</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/points/hitpoints.js~HitPoints.html">HitPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/points/mana.js~Mana.html">Mana</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/points/points.js~Points.html">Points</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-profession">src/server/js/game/entity/character/player/profession</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/profession/profession.js~Profession.html">Profession</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-profession-impl">src/server/js/game/entity/character/player/profession/impl</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/profession/impl/foresting.js~Foresting.html">Foresting</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-quest">src/server/js/game/entity/character/player/quest</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/quest/quest.js~Quest.html">Quest</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-character-player-quest-misc">src/server/js/game/entity/character/player/quest/misc</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/quest/misc/bulkysituation.js~BulkySituation.html">BulkySituation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/quest/misc/introduction.js~Introduction.html">Introduction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/character/player/quest/misc/thelie.js~TheLie.html">TheLie</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-npc">src/server/js/game/entity/npc</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/npc/npc.js~NPC.html">NPC</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-game-entity-objects">src/server/js/game/entity/objects</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/objects/chest.js~Chest.html">Chest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/objects/item.js~Item.html">Item</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/game/entity/objects/projectile.js~Projectile.html">Projectile</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-map">src/server/js/map</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/map/area.js~Area.html">Area</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/map/grids.js~Grids.html">Grids</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/map/groups.js~Groups.html">Groups</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/map/map.js~Map.html">Map</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-map-areas">src/server/js/map/areas</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/map/areas/chestareas.js~ChestAreas.html">ChestAreas</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/map/areas/musicareas.js~MusicAreas.html">MusicAreas</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/map/areas/pvpareas.js~PVPAreas.html">PVPAreas</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-minigames">src/server/js/minigames</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/minigames/minigame.js~Minigame.html">Minigame</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-minigames-impl">src/server/js/minigames/impl</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/minigames/impl/teamwar.js~TeamWar.html">TeamWar</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-network">src/server/js/network</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/network/socket.js~Socket.html">Socket</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-server-js-util">src/server/js/util</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/server/js/util/parser.js~Parser.html">Parser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-requireItems">requireItems</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AbilityDictionary">AbilityDictionary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ItemsDictionary">ItemsDictionary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MobsDictionary">MobsDictionary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NpcsDictionary">NpcsDictionary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ShopsDictionary">ShopsDictionary</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-tools-api">src/tools/api</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/tools/api/registrar.js~Registrar.html">Registrar</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-tools-bot">src/tools/bot</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/WTF-Adventure/src/tools/bot/bot.js~Bot.html">Bot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#src-tools-map">src/tools/map</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parse">parse</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">WTF-Adventure/src/server/js/game/entity/character/player/player.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import log from &apos;../../../../util/log&apos;;
import Character from &apos;../character&apos;;
import Incoming from &apos;../../../../controllers/incoming&apos;;
import Armour from &apos;./equipment/armour&apos;;
import Weapon from &apos;./equipment/weapon&apos;;
import Pendant from &apos;./equipment/pendant&apos;;
import Ring from &apos;./equipment/ring&apos;;
import Boots from &apos;./equipment/boots&apos;;
import ItemsDictionary from &apos;../../../../util/items&apos;;
import Messages from &apos;../../../../network/messages&apos;;
import Formulas from &apos;../../../formulas&apos;;
import Hitpoints from &apos;./points/hitpoints&apos;;
import Mana from &apos;./points/mana&apos;;
import Packets from &apos;../../../../network/packets&apos;;
import Modules from &apos;../../../../util/modules&apos;;
import Handler from &apos;./handler&apos;;
import Quests from &apos;../../../../controllers/quests&apos;;
import Inventory from &apos;./containers/inventory/inventory&apos;;
import Abilities from &apos;./ability/abilities&apos;;
import Bank from &apos;./containers/bank/bank&apos;;
import config from &apos;../../../../../config.json&apos;;
import Enchant from &apos;./enchant/enchant&apos;;
import Guild from &apos;./guild&apos;;
import Utils from &apos;../../../../util/utils&apos;;
import Hit from &apos;../combat/hit&apos;;
import Trade from &apos;./trade&apos;;
import Warp from &apos;./warp&apos;;

export default class Player extends Character {
  constructor(world, database, connection, clientId) {
    super(-1, &apos;player&apos;, connection.id, -1, -1);

    this.world = world;
    this.mysql = database;
    this.connection = connection;

    this.clientId = clientId;

    this.incoming = new Incoming(this);

    this.isNew = false;
    this.ready = false;

    this.moving = false;
    this.potentialPosition = null;
    this.futurePosition = null;

    this.groupPosition = null;
    this.newGroup = false;

    this.disconnectTimeout = null;
    this.timeoutDuration = 1000 * 60 * 10; // 10 minutes

    this.handler = new Handler(this);

    this.inventory = new Inventory(this, 20);
    this.bank = new Bank(this, 56);
    this.quests = new Quests(this);
    this.abilities = new Abilities(this);
    this.enchant = new Enchant(this);
    this.trade = new Trade(this);
    this.warp = new Warp(this);
    this.itemsDictionary = ItemsDictionary;

    this.introduced = false;
    this.currentSong = null;
    this.acceptedTrade = false;
    this.invincible = false;
    this.noDamage = false;

    this.isGuest = false;

    this.pvp = false;

    this.canTalk = true;

    this.profileDialogOpen = false;
  }

  load(data) {
    this.loaded = true;
    this.kind = data.kind;
    this.rights = data.rights;
    this.experience = data.experience;
    this.ban = data.ban;
    this.mute = data.mute;
    this.membership = data.membership;
    this.lastLogin = data.lastLogin;
    this.pvpKills = data.pvpKills;
    this.pvpDeaths = data.pvpDeaths;

    this.warp.setLastWarp(data.lastWarp);

    this.level = Formulas.expToLevel(this.experience);
    this.hitPoints = new Hitpoints(
      data.hitPoints,
      Formulas.getMaxHitPoints(this.level),
    );
    this.mana = new Mana(data.mana, Formulas.getMaxMana(this.level));

    const {
      armour,
      weapon,
      pendant,
      ring,
      boots,
    } = data;

    this.setPosition(data.x, data.y);
    this.setArmour(armour[0], armour[1], armour[2], armour[3]);
    this.setWeapon(weapon[0], weapon[1], weapon[2], weapon[3]);
    this.setPendant(pendant[0], pendant[1], pendant[2], pendant[3]);
    this.setRing(ring[0], ring[1], ring[2], ring[3]);
    this.setBoots(boots[0], boots[1], boots[2], boots[3]);

    this.guild = new Guild(data.guild, this);
  }

  loadInventory() {
    if (config.offlineMode) {
      this.inventory.loadEmpty();
      return;
    }

    this.mysql.loader.getInventory(this, (
      ids,
      counts,
      skills,
      skillLevels,
    ) =&gt; {
      if (ids.length !== this.inventory.size) {
        this.save();
      }

      this.inventory.load(ids, counts, skills, skillLevels);
      this.inventory.check();
    });
  }

  loadBank() {
    if (config.offlineMode) {
      this.bank.loadEmpty();
      return;
    }

    this.mysql.loader.getBank(this, (ids, counts, skills, skillLevels) =&gt; {
      if (ids.length !== this.bank.size) {
        this.save();
      }

      this.bank.load(ids, counts, skills, skillLevels);
      this.bank.check();
    });
  }

  loadQuests() {
    if (config.offlineMode) {
      return;
    }

    this.mysql.loader.getQuests(this, (ids, stages) =&gt; {
      ids.pop();
      stages.pop();

      if (this.quests.getQuestSize() !== ids.length) {
        console.log(&apos;Mismatch in quest data.&apos;);
        this.save();
      }

      this.quests.updateQuests(ids, stages);
    });

    this.mysql.loader.getAchievements(this, (ids, progress) =&gt; {
      ids.pop();
      progress.pop();

      if (this.quests.getAchievementSize() !== ids.length) {
        console.log(&apos;Mismatch in achievements data.&apos;);

        this.save();
      }

      this.quests.updateAchievements(ids, progress);
    });

    this.quests.onReady(() =&gt; {
      this.send(
        new Messages.Quest(Packets.QuestOpcode.Batch, this.quests.getData()),
      );
    });
  }

  intro() {
    if (this.ban &gt; new Date()) {
      this.connection.sendUTF8(&apos;ban&apos;);
      console.log(this.connection);
      this.connection.close(`Player: ${this.username} is banned.`);
    }

    if (this.x &lt;= 0 || this.y &lt;= 0) this.sendToSpawn();

    if (this.hitPoints.getHitPoints() &lt; 0) this.hitPoints.setHitPoints(this.getMaxHitPoints());

    if (this.mana.getMana() &lt; 0) this.mana.setMana(this.mana.getMaxMana());

    const info = {
      instance: this.instance,
      username: this.username,
      x: this.x,
      y: this.y,
      kind: this.kind,
      rights: this.rights,
      hitPoints: this.hitPoints.getData(),
      mana: this.mana.getData(),
      experience: this.experience,
      level: this.level,
      lastLogin: this.lastLogin,
      pvpKills: this.pvpKills,
      pvpDeaths: this.pvpDeaths,
    };

    this.groupPosition = [this.x, this.y];

    /**
     * Send player data to client here
     */

    this.world.addPlayer(this);

    this.send(new Messages.Welcome(info));
  }

  addExperience(exp) {
    this.experience += exp;

    const oldLevel = this.level;

    this.level = Formulas.expToLevel(this.experience);

    if (oldLevel !== this.level) {
      this.hitPoints.setMaxHitPoints(Formulas.getMaxHitPoints(this.level));
    }

    this.world.pushToAdjacentGroups(
      this.group,
      new Messages.Experience({
        id: this.instance,
        amount: exp,
        experience: this.experience,
        level: this.level,
      }),
    );
  }

  heal(amount) {
    this.hitPoints = this.healHitPoints(amount);
    this.mana = this.healManaPoints(amount);
  }

  healHitPoints(amount) {
    const
      type = &apos;health&apos;;

    if (this.hitPoints &amp;&amp; this.hitPoints.points &lt; this.hitPoints.maxPoints) {
      this.hitPoints.heal(amount);

      this.sync();

      this.world.pushToAdjacentGroups(
        this.group,
        new Messages.Heal({
          id: this.instance,
          type,
          amount,
        }),
      );
    }
  }

  healManaPoints(amount) {
    const
      type = &apos;mana&apos;;

    if (this.mana &amp;&amp; this.mana.points &lt; this.mana.maxPoints) {
      this.mana.heal(amount);

      this.sync();

      this.world.pushToAdjacentGroups(
        this.group,
        new Messages.Heal({
          id: this.instance,
          type,
          amount,
        }),
      );
    }
  }

  eat(id) {
    if (this.itemsDictionary.hasPlugin(id)) {
      const tempItem = new (this.itemsDictionary.isNewPlugin(id))(id, -1, this.x, this.y);

      tempItem.onUse(this);

      // plugins are responsible for sync and messages to player,
      // or calling player methods that handle that
    }
  }

  equip(string, count, ability, abilityLevel) {
    const data = this.itemsDictionary.getData(string);
    let type;

    if (!data || data === &apos;null&apos;) {
      return;
    }

    if (this.itemsDictionary.isArmour(string)) {
      type = Modules.Equipment.Armour;
    } else if (this.itemsDictionary.isWeapon(string)) {
      type = Modules.Equipment.Weapon;
    } else if (this.itemsDictionary.isPendant(string)) {
      type = Modules.Equipment.Pendant;
    } else if (this.itemsDictionary.isRing(string)) {
      type = Modules.Equipment.Ring;
    } else if (this.itemsDictionary.isBoots(string)) {
      type = Modules.Equipment.Boots;
    }

    const id = this.itemsDictionary.stringToId(string);

    switch (type) {
      default:
        break;
      case Modules.Equipment.Armour:
        if (this.hasArmour() &amp;&amp; this.armour.id !== 114) this.inventory.add(this.armour.getItem());

        this.setArmour(id, count, ability, abilityLevel);
        break;

      case Modules.Equipment.Weapon:
        if (this.hasWeapon()) this.inventory.add(this.weapon.getItem());

        this.setWeapon(id, count, ability, abilityLevel);
        break;

      case Modules.Equipment.Pendant:
        if (this.hasPendant()) this.inventory.add(this.pendant.getItem());

        this.setPendant(id, count, ability, abilityLevel);
        break;

      case Modules.Equipment.Ring:
        if (this.hasRing()) this.inventory.add(this.ring.getItem());

        this.setRing(id, count, ability, abilityLevel);
        break;

      case Modules.Equipment.Boots:
        if (this.hasBoots()) this.inventory.add(this.boots.getItem());

        this.setBoots(id, count, ability, abilityLevel);
        break;
    }

    this.send(
      new Messages.Equipment(Packets.EquipmentOpcode.Equip, [
        type,
        this.itemsDictionary.idToName(id),
        string,
        count,
        ability,
        abilityLevel,
      ]),
    );

    this.sync();
  }

  canEquip(string) {
    const
      requirement = this.itemsDictionary.getLevelRequirement(string);

    if (requirement &gt; this.level) {
      this.notify(
        `You must be at least level ${requirement} to equip this.`,
      );
      return false;
    }

    return true;
  }

  die() {
    this.dead = true;

    if (this.deathCallback) this.deathCallback();

    this.send(new Messages.Death(this.instance));
  }

  teleport(x, y, isDoor, animate) {
    if (isDoor &amp;&amp; !this.finishedTutorial()) {
      if (this.doorCallback) {
        this.doorCallback(x, y);
      }
      return;
    }

    this.world.pushToAdjacentGroups(
      this.group,
      new Messages.Teleport(this.instance, x, y, animate),
    );

    this.setPosition(x, y);
    this.checkGroups();

    this.world.cleanCombat(this);
  }

  updatePVP(pvp) {
    /**
     * No need to update if the state is the same
     */

    if (this.pvp === pvp) return;

    if (this.pvp &amp;&amp; !pvp) this.notify(&apos;You are no longer in a PvP zone!&apos;);
    else this.notify(&apos;You have entered a PvP zone!&apos;);

    this.pvp = pvp;

    this.sendToGroup(new Messages.PVP(this.instance, this.pvp));
  }

  updateMusic(song) {
    this.currentSong = song;

    this.send(new Messages.Audio(song));
  }

  revertPoints() {
    this.hitPoints.setHitPoints(this.hitPoints.getMaxHitPoints());
    this.mana.setMana(this.mana.getMaxMana());

    this.sync();
  }

  applyDamage(damage) {
    this.hitPoints.decrement(damage);
  }

  toggleProfile(state) {
    this.profileDialogOpen = state;

    if (this.profileToggleCallback) this.profileToggleCallback();
  }

  getMana() {
    return this.mana.getMana();
  }

  getMaxMana() {
    return this.mana.getMaxMana();
  }

  getHitPoints() {
    return this.hitPoints.getHitPoints();
  }

  getMaxHitPoints() {
    return this.hitPoints.getMaxHitPoints();
  }

  getTutorial() {
    return this.quests.getQuest(Modules.Quests.Introduction);
  }

  /**
   * Setters
   */

  setArmour(id, count, ability, abilityLevel) {
    if (!id) return;

    this.armour = new Armour(
      this.itemsDictionary.idToString(id),
      id,
      count,
      ability,
      abilityLevel,
    );
  }

  breakWeapon() {
    this.notify(&apos;Your weapon has been broken.&apos;);

    this.setWeapon(-1, 0, 0, 0);

    this.sendEquipment();
  }

  setWeapon(id, count, ability, abilityLevel) {
    if (!id) return;

    this.weapon = new Weapon(
      this.itemsDictionary.idToString(id),
      id,
      count,
      ability,
      abilityLevel,
    );

    if (this.weapon.ranged) this.attackRange = 7;
  }

  setPendant(id, count, ability, abilityLevel) {
    if (!id) return;

    this.pendant = new Pendant(
      this.itemsDictionary.idToString(id),
      id,
      count,
      ability,
      abilityLevel,
    );
  }

  setRing(id, count, ability, abilityLevel) {
    if (!id) return;

    this.ring = new Ring(
      this.itemsDictionary.idToString(id),
      id,
      count,
      ability,
      abilityLevel,
    );
  }

  setBoots(id, count, ability, abilityLevel) {
    if (!id) {
      return;
    }

    this.boots = new Boots(
      this.itemsDictionary.idToString(id),
      id,
      count,
      ability,
      abilityLevel,
    );
  }

  guessPosition(x, y) {
    this.potentialPosition = {
      x,
      y,
    };
  }

  setPosition(x, y) {
    if (this.dead) {
      return;
    }

    super.setPosition(x, y);

    this.world.pushToAdjacentGroups(
      this.group,
      new Messages.Movement(Packets.MovementOpcode.Move, [
        this.instance,
        x,
        y,
        false,
        false,
      ]),
      this.instance,
    );
  }

  setFuturePosition(x, y) {
    /**
     * Most likely will be used for anti-cheating methods
     * of calculating the actual time and duration for the
     * displacement.
     */

    this.futurePosition = {
      x,
      y,
    };
  }

  timeout() {
    this.connection.sendUTF8(&apos;timeout&apos;);
    console.log(&apos;timeout&apos;, this.connection);
    this.connection.close(`${this.username} timed out.`);
  }

  invalidLogin() {
    this.connection.sendUTF8(&apos;invalidlogin&apos;);
    console.log(&apos;connection&apos;, this.connection);
    this.connection.close(`${this.username} invalid login.`);
  }

  refreshTimeout() {
    clearTimeout(this.disconnectTimeout);

    this.disconnectTimeout = setTimeout(() =&gt; {
      this.timeout();
    }, this.timeoutDuration);
  }

  /**
   * Getters
   */

  hasArmour() {
    return this.armour &amp;&amp; this.armour.name !== &apos;null&apos; &amp;&amp; this.armour.id !== -1;
  }

  hasWeapon() {
    return this.weapon &amp;&amp; this.weapon.name !== &apos;null&apos; &amp;&amp; this.weapon.id !== -1;
  }

  hasBreakableWeapon() {
    return this.weapon &amp;&amp; this.weapon.breakable;
  }

  hasPendant() {
    return (
      this.pendant &amp;&amp; this.pendant.name !== &apos;null&apos; &amp;&amp; this.pendant.id !== -1
    );
  }

  hasRing() {
    return this.ring &amp;&amp; this.ring.name !== &apos;null&apos; &amp;&amp; this.ring.id !== -1;
  }

  hasBoots() {
    return this.boots &amp;&amp; this.boots.name !== &apos;null&apos; &amp;&amp; this.boots.id !== -1;
  }

  hasMaxHitPoints() {
    return this.getHitPoints() &gt;= this.hitPoints.getMaxHitPoints();
  }

  hasMaxMana() {
    return this.mana.getMana() &gt;= this.mana.getMaxMana();
  }

  hasSpecialAttack() {
    return (
      this.weapon
      &amp;&amp; (this.weapon.hasCritical()
        || this.weapon.hasExplosive()
        || this.weapon.hasStun())
    );
  }

  canBeStunned() {
    return true;
  }

  getState() {
    return {
      type: this.type,
      id: this.instance,
      name: this.username,
      x: this.x,
      y: this.y,
      rights: this.rights,
      level: this.level,
      pvp: this.pvp,
      pvpKills: this.pvpKills,
      pvpDeaths: this.pvpDeaths,
      hitPoints: this.hitPoints.getData(),
      mana: this.mana.getData(),
      armour: this.armour.getData(),
      weapon: this.weapon.getData(),
      pendant: this.pendant.getData(),
      ring: this.ring.getData(),
      boots: this.boots.getData(),
    };
  }

  getRemoteAddress() {
    return this.connection.socket.conn.remoteAddress;
  }

  getSpawn() {
    let
      position;

    /**
     * Here we will implement functions from quests and
     * other special events and determine a spawn point.
     */

    if (this.getTutorial().isFinished()) {
      position = {
        x: 325,
        y: 86,
      };
    } else {
      position = {
        x: 17,
        y: 555,
      };
    }

    return position;
  }

  getHit(target) {
    const defaultDamage = Formulas.getDamage(this, target);
    const isSpecial = 100 - this.weapon.abilityLevel &lt; Utils.randomInt(0, 100);

    if (!this.hasSpecialAttack() || !isSpecial) {
      return new Hit(Modules.Hits.Damage, defaultDamage);
    }

    switch (this.weapon.ability) {
      default:
        break;
      case Modules.Enchantment.Critical:
        /**
         * Still experimental, not sure how likely it is that you&apos;re
         * gonna do a critical strike. I just do not want it getting
         * out of hand, it&apos;s easier to buff than to nerf..
         */

        const multiplier = 1.0 + this.weapon.abilityLevel; // eslint-disable-line
        const damage = defaultDamage * multiplier; // eslint-disable-line

        return new Hit(Modules.Hits.Critical, damage);

      case Modules.Enchantment.Stun:
        return new Hit(Modules.Hits.Stun, defaultDamage);

      case Modules.Enchantment.Explosive:
        return new Hit(Modules.Hits.Explosive, defaultDamage);
    }

    return null;
  }

  isMuted() {
    const
      time = new Date().getTime();

    return this.mute - time &gt; 0;
  }

  isRanged() {
    return this.weapon &amp;&amp; this.weapon.isRanged();
  }

  isDead() {
    return this.getHitPoints() &lt; 1 || this.dead;
  }

  /**
   * Miscellaneous
   */

  send(message) {
    this.world.pushToPlayer(this, message);
  }

  sendToGroup(message) {
    this.world.pushToGroup(this.group, message);
  }

  sendEquipment() {
    const
      info = [
        this.armour.getData(),
        this.weapon.getData(),
        this.pendant.getData(),
        this.ring.getData(),
        this.boots.getData(),
      ];

    this.send(new Messages.Equipment(Packets.EquipmentOpcode.Batch, info));
  }

  sendToSpawn() {
    const
      position = this.getSpawn();

    this.x = position.x;
    this.y = position.y;
  }

  sync(all) {
    /**
     * Function to be used for syncing up health,
     * mana, exp, and other variables
     */

    if (!this.hitPoints || !this.mana) return;

    const info = {
      id: this.instance,
      hitPoints: this.getHitPoints(),
      maxHitPoints: this.getMaxHitPoints(),
      mana: this.mana.getMana(),
      maxMana: this.mana.getMaxMana(),
      experience: this.experience,
      level: this.level,
      armour: this.armour.getName(),
      weapon: this.weapon.getData(),
    };

    this.world.pushToAdjacentGroups(
      this.group,
      new Messages.Sync(info),
      all ? null : this.instance,
    );

    this.save();
  }

  notify(message) {
    if (!message) return;

    this.send(
      new Messages.Notification(Packets.NotificationOpcode.Text, message),
    );
  }

  stopMovement(force) {
    /**
     * Forcefully stopping the player will simply hault
     * them in between tiles. Should only be used if they are
     * being transported elsewhere.
     */


    this.send(new Messages.Movement(Packets.MovementOpcode.Stop, force));
  }

  finishedTutorial() {
    if (!this.quests) return true;

    return this.getTutorial().isFinished();
  }

  checkGroups() {
    if (!this.groupPosition) return;

    const diffX = Math.abs(this.groupPosition[0] - this.x);


    const diffY = Math.abs(this.groupPosition[1] - this.y);

    if (diffX &gt;= 10 || diffY &gt;= 10) {
      this.groupPosition = [this.x, this.y];

      if (this.groupCallback) this.groupCallback();
    }
  }

  movePlayer() {
    /**
     * Server-sided callbacks towards movement should
     * not be able to be overwritten. In the case that
     * this is used (for Quests most likely) the server must
     * check that no hacker removed the constraint in the client-side.
     * If they are not within the bounds, apply the according punishment.
     */

    this.send(new Messages.Movement(Packets.MovementOpcode.Started));
  }

  walkRandomly() {
    setInterval(() =&gt; {
      this.setPosition(
        this.x + Utils.randomInt(-5, 5),
        this.y + Utils.randomInt(-5, 5),
      );
    }, 2000);
  }

  killCharacter(character) {
    if (this.killCallback) this.killCallback(character);
  }

  save() {
    if (config.offlineMode || this.isGuest) return;

    this.mysql.creator.save(this);
  }

  inTutorial() {
    return this.world.map.inTutorialArea(this);
  }

  onGroup(callback) {
    this.groupCallback = callback;
  }

  onAttack(callback) {
    this.attackCallback = callback;
  }

  onHit(callback) {
    this.hitCallback = callback;
  }

  onKill(callback) {
    this.killCallback = callback;
  }

  onDeath(callback) {
    this.deathCallback = callback;
  }

  onTalkToNPC(callback) {
    this.npcTalkCallback = callback;
  }

  onDoor(callback) {
    this.doorCallback = callback;
  }

  onProfile(callback) {
    this.profileToggleCallback = callback;
  }

  onReady(callback) {
    this.readyCallback = callback;
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
